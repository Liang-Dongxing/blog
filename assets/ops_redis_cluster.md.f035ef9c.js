import{_ as s,c as a,o as n,a as l}from"./app.0a9bfa31.js";const F=JSON.parse('{"title":"RedisCluster redis集群搭建","description":"","frontmatter":{},"headers":[{"level":2,"title":"安装Redis","slug":"安装redis","link":"#安装redis","children":[]},{"level":2,"title":"创建集群配置文件","slug":"创建集群配置文件","link":"#创建集群配置文件","children":[{"level":3,"title":"如果是多台机器，每台机器都需要开启防火墙端口号","slug":"如果是多台机器-每台机器都需要开启防火墙端口号","link":"#如果是多台机器-每台机器都需要开启防火墙端口号","children":[]}]},{"level":2,"title":"启动六个节点","slug":"启动六个节点","link":"#启动六个节点","children":[]},{"level":2,"title":"6个节点合成一个集群","slug":"_6个节点合成一个集群","link":"#_6个节点合成一个集群","children":[]}],"relativePath":"ops/redis_cluster.md","lastUpdated":1666684617000}'),p={name:"ops/redis_cluster.md"},o=l(`<h1 id="rediscluster-redis集群搭建" tabindex="-1">RedisCluster redis集群搭建 <a class="header-anchor" href="#rediscluster-redis集群搭建" aria-hidden="true">#</a></h1><h2 id="安装redis" tabindex="-1">安装Redis <a class="header-anchor" href="#安装redis" aria-hidden="true">#</a></h2><p>官网下载redis源码包，<a href="https://redis.io/download/" target="_blank" rel="noreferrer">https://redis.io/download/</a></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 解压安装包</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-zxvf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis-7.0.4.tar.gz</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 进入redis目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis-7.0.4</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 编译</span></span>
<span class="line"><span style="color:#FFCB6B;">make</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 安装</span></span>
<span class="line"><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><h2 id="创建集群配置文件" tabindex="-1">创建集群配置文件 <a class="header-anchor" href="#创建集群配置文件" aria-hidden="true">#</a></h2><p>集群最少需要6个节点，6379，6380，6381，6382，6383，6384</p><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># 导入默认配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">include /sndata/trs/redis/redis-7.0.4/redis.conf</span></span>
<span class="line"><span style="color:#A6ACCD;"># 更具节点数量修改配置端口</span></span>
<span class="line"><span style="color:#A6ACCD;">port 6379</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">pidfile redis_6379.pid</span></span>
<span class="line"><span style="color:#A6ACCD;">dbfilename dump6379.rdb</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">cluster-enabled yes</span></span>
<span class="line"><span style="color:#A6ACCD;">cluster-config-file nodes-6379.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">cluster-node-timeout 15000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>修改好六个配置文件，redis6379.conf，redis6380.conf，redis6381.conf，redis6382.conf，redis6383.conf，redis6384.conf</p><h3 id="如果是多台机器-每台机器都需要开启防火墙端口号" tabindex="-1">如果是多台机器，每台机器都需要开启防火墙端口号 <a class="header-anchor" href="#如果是多台机器-每台机器都需要开启防火墙端口号" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6379/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6380/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6381/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6382/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6383/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6384/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 为了集群启动成功需要另外开启6个端口号</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># https://redis.io/docs/reference/cluster-spec/#the-cluster-bus</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 集群tcp端口逻辑是 reids端口+10000 生成的</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=16379/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=16380/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=16381/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=16382/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=16383/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=16384/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--reload</span></span>
<span class="line"></span></code></pre></div><h2 id="启动六个节点" tabindex="-1">启动六个节点 <a class="header-anchor" href="#启动六个节点" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">redis-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis6379.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">redis-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis6380.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">redis-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis6381.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">redis-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis6382.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">redis-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis6383.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">redis-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis6384.conf</span></span>
<span class="line"></span></code></pre></div><h2 id="_6个节点合成一个集群" tabindex="-1">6个节点合成一个集群 <a class="header-anchor" href="#_6个节点合成一个集群" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-diff" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">redis-cli</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--cluster</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--cluster-replicas</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.26:</span><span style="color:#F78C6C;">6379</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.26:</span><span style="color:#F78C6C;">6380</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.26:</span><span style="color:#F78C6C;">6381</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.26:</span><span style="color:#F78C6C;">3682</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.26:</span><span style="color:#F78C6C;">6383</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.26:</span><span style="color:#F78C6C;">6384</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">password</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 结果</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Performing</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slots</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">allocation</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodes...</span></span>
<span class="line"><span style="color:#FFCB6B;">Master[0</span><span style="color:#A6ACCD;">] -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Slots </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> - </span><span style="color:#F78C6C;">5460</span></span>
<span class="line"><span style="color:#FFCB6B;">Master[1</span><span style="color:#A6ACCD;">] -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Slots </span><span style="color:#F78C6C;">5461</span><span style="color:#A6ACCD;"> - </span><span style="color:#F78C6C;">10922</span></span>
<span class="line"><span style="color:#FFCB6B;">Master[2</span><span style="color:#A6ACCD;">] -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Slots </span><span style="color:#F78C6C;">10923</span><span style="color:#A6ACCD;"> - </span><span style="color:#F78C6C;">16383</span></span>
<span class="line"><span style="color:#FFCB6B;">Adding</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replica</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6380</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6379</span></span>
<span class="line"><span style="color:#FFCB6B;">Adding</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replica</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6381</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6382</span></span>
<span class="line"><span style="color:#FFCB6B;">Adding</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replica</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6383</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6384</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Trying</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">optimize</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slaves</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">allocation</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">anti-affinity</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">WARNING</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> Some slaves are </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> the same host as their master</span></span>
<span class="line"><span style="color:#FFCB6B;">M:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">238d2029024a6c31a6991a74edde9ec543af58e9</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6379</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:[0-5460</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5461</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> master</span></span>
<span class="line"><span style="color:#FFCB6B;">M:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8cda5c5d9a99e54b552bde7f4630f402ca327c47</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6384</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:[10923-16383</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5461</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> master</span></span>
<span class="line"><span style="color:#FFCB6B;">S:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">80a265292e2fc1165ea19b6a1eee2729448f55dd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6381</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">replicates</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8a94ba9930f1970f4156b84b1cb6aaa63a9ecc8a</span></span>
<span class="line"><span style="color:#FFCB6B;">S:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">edcb86fe121d8f76f9beba8d28e41990d152228d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6383</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">replicates</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8cda5c5d9a99e54b552bde7f4630f402ca327c47</span></span>
<span class="line"><span style="color:#FFCB6B;">M:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8a94ba9930f1970f4156b84b1cb6aaa63a9ecc8a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6382</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:[5461-10922</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5462</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> master</span></span>
<span class="line"><span style="color:#FFCB6B;">S:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b8c72330e7622cbf9c2f7379a9974e90130ca355</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6380</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">replicates</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">238d2029024a6c31a6991a74edde9ec543af58e9</span></span>
<span class="line"><span style="color:#FFCB6B;">Can</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">I</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">above</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configuration?</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">yes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">accept</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">: </span><span style="color:#C3E88D;">yes</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Nodes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configuration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">updated</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Assign</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">different</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">epoch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">each</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Sending</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CLUSTER</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MEET</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">messages</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">join</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cluster</span></span>
<span class="line"><span style="color:#FFCB6B;">Waiting</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cluster</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">join</span></span>
<span class="line"><span style="color:#82AAFF;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Performing</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Cluster</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Check</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">M:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">238d2029024a6c31a6991a74edde9ec543af58e9</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6379</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:[0-5460</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5461</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> master</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">additional</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replica</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">s</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">M:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8a94ba9930f1970f4156b84b1cb6aaa63a9ecc8a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6382</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:[5461-10922</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5462</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> master</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">additional</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replica</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">s</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">S:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b8c72330e7622cbf9c2f7379a9974e90130ca355</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6380</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slave</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">replicates</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">238d2029024a6c31a6991a74edde9ec543af58e9</span></span>
<span class="line"><span style="color:#FFCB6B;">S:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">80a265292e2fc1165ea19b6a1eee2729448f55dd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6381</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slave</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">replicates</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8a94ba9930f1970f4156b84b1cb6aaa63a9ecc8a</span></span>
<span class="line"><span style="color:#FFCB6B;">M:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8cda5c5d9a99e54b552bde7f4630f402ca327c47</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6384</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:[10923-16383</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5461</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> master</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">additional</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replica</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">s</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">S:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">edcb86fe121d8f76f9beba8d28e41990d152228d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.105.25:</span><span style="color:#F78C6C;">6383</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">slots:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> slots</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slave</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">replicates</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8cda5c5d9a99e54b552bde7f4630f402ca327c47</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">OK</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> All nodes agree about slots configuration.</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Check</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">open</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slots...</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">Check</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">slots</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">coverage...</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">OK</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> All </span><span style="color:#F78C6C;">16384</span><span style="color:#A6ACCD;"> slots covered.</span></span>
<span class="line"></span></code></pre></div><p><strong>注：</strong></p><ol><li>六个节点合并一个集群时候如果停留在 “Waiting for the cluster to join”此处，检测端口和防火墙，这里是需要多开启几个端口。<a href="https://redis.io/docs/reference/cluster-spec/#the-cluster-bus" target="_blank" rel="noreferrer">https://redis.io/docs/reference/cluster-spec/#the-cluster-bus</a></li><li>如果集群挂掉后，重新启动集群出现 [ERR] Node 192.168.105.25:36379 is not empty. Either the node already knows other nodes (check with CLUSTER NODES) or contains some key in database 0. 则是节点下没有清空，需要清空节点下的数据。<div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/sndata/trs/redis/redis-7.0.4/nodes</span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/sndata/trs/redis/redis-7.0.4/dump</span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.rdb</span></span>
<span class="line"></span></code></pre></div></li></ol>`,16),e=[o];function c(t,r,C,y,A,D){return n(),a("div",null,e)}const d=s(p,[["render",c]]);export{F as __pageData,d as default};
